@using LearnKendoUiAspMvc.Models
@using Prototyping.Ipsum
@using Prototyping.Placeholdit
@using LearnKendoUiAspMvc.Models

@{
    ViewBag.Title = "Team Efficiency";
}

<section id="app-title-bar" class="row">
    <div class="col-sm-3">
        <h1 class="title">@ViewBag.Title</h1>
    </div>
</section>

<div class="app-wrapper">
    <!-- Menu Panel -->
    <div class="overflow-hidden" style="float:left;">
        <h3>Report Range</h3>
        <p>@Html.Label("Stats from")</p>
        <p>
            <!-- Stats From Date Picker -->
            @(Html.Kendo().DatePicker()
                .Name("StatsFrom")
                .Value(new DateTime(1996, 1, 1))
                )
        </p>
        <p>@Html.Label("Stats to")</p>
        <p>
            <!-- Stats To Date Picker -->
            @(Html.Kendo().DatePicker()
                .Name("StatsTo")
                .Value(new DateTime(1998, 8, 1))
                )
        </p>
        <nav id="employee-list">
            <h3>Team members</h3>
            <!-- Employee List View -->
        @(Html.Kendo().ListView<Employee>()
            .Name("EmployeesList")
            .ClientTemplateId("EmployeeItemTemplate")
            .TagName("ul")
            .DataSource(dataSource =>
            {
                dataSource.Read(read => read.Action("EmployeesList_Read", "Home"));
                dataSource.PageSize(12);
            })
            .Selectable(s => s.Mode(ListViewSelectionMode.Single))
            .Events(e => e
                .DataBound("onListDataBound")
                .Change("onCriteriaChange")
            )
            )
            <ul>
                <li class="employee">
                    <div>
                        @Html.Placehold(30,30, "E")
                        <span>Full Name</span>
                    </div>
                </li>
                <li class="employee">
                    <div>
                        @Html.Placehold(30, 30, "E")
                        <span>Full Name</span>
                    </div>
                </li>
                <li class="employee">
                    <div>
                        @Html.Placehold(30, 30, "E")
                        <span>Full Name</span>
                    </div>
                </li>
            </ul>
        </nav>
    </div>
    <!-- /Menu Panel -->

    <section id="main-section-content" class="row">
        <article class="col-md-12">
            <button id="windowButton" class="k-button">Open</button>
            <div>
                @(Html.Kendo().Window()
                    .Name("window")
                    .Title("Window title")
                    .Draggable(true)
                    .Visible(false)
                    .Width(500)
                    .Height(300)
                    .Content(@<text>
                                 Static content of the Window.
                              </text>)
                    .Actions(actions => actions.Close())
                    )
            </div>

            <div id="employee-details" class="row">
                <div id="employee-about" class="col-md-12 col-lg-4">
                    <!-- Employee Avatar -->
                    @Html.Placehold(90, 90, "Face")
                    <span>Full Name </span>
                </div>
                <div class="col-md-12 col-lg-4">
                    <div class="chart-wrap">
                        <h3 class="chart-title">Quarter to date sales</h3>
                        <p class="sales-report-value" id="EmployeeQuarterSalesLabel"></p>
                        <!-- QTD Sales Chart -->
                        @Html.Placehold(430, 120, "Chart")
                    </div>
                </div>
                <div class="col-md-12 col-lg-4">
                    <div class="chart-wrap">
                        <h3 class="chart-title">Monthly Average Sales</h3>
                        <p class="sales-report-value" id="EmployeeAverageSalesLabel"></p>
                        <!-- Montly Sales Chart -->
                        @Html.Placehold(430, 120, "Chart")
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <h3>Representative Invoice</h3>
                    <!-- Invoices -->
                    @Html.Action("Index", "Invoice")
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <h3>Representative orders</h3>
                    <!-- Orders -->
                    @Html.Action("Index", "Grid")
                </div>
            </div>
        </article>
    </section>
</div>

<!-- Kendo Templates -->
<script type="text/x-kendo-tmpl" id="EmployeeItemTemplate">
    <li class="employee">
        <div>
            <img src="@(Url.Content("~/content/employees/"))#:EmployeeId#-t.png" />
            <span> #: FullName #</span>
        </div>
    </li>
</script>

<script type="text/x-kendo-tmpl" id="employeeAvatarTemplate">
    <img src="@(Url.Content("~/content/employees/"))#:EmployeeId#.png" />
    <span>#:FullName#</span>
</script>

<!-- /Kendo Templates -->

@section Scripts {
    <script>

        // Window
        var myWindow = $("#window");

        myWindow.center();

        var myWindowData = $("window").data("kendoWindow");

        $("#windowButton").click( function (e) {
            myWindow.data("kendoWindow").open();
        })
        
        //Custom Scripts
        function onListDataBound(e) {
            var listView = this;
            var firstChild = listView.element.children().first();
            listView.select(firstChild);
        }

        function getSelectedEmployee() {
            var employeeList = $("#EmployeesList").data("kendoListView"),
                employee = employeeList.dataSource.getByUid(employeeList.select().attr("data-uid"));
            return employee;
        }

        function updateEmployeeAvatar() {
            var employee = getSelectedEmployee(),
                template = kendo.template($("#employeeAvatarTemplate").html());

            //apply template
            $("#employee-about").html(template(employee));
        }

        function getEmployeeFilter() {
            var employee = getSelectedEmployee(),
                statsFrom = $("#StatsFrom").data("kendoDatePicker"),
                statsTo = $("#StatsTo").data("kendoDatePicker");

            var filter = {
                employeeId: employee.EmployeeId,
                salesPerson: employee.FullName,
                statsFrom: statsFrom.value(),
                statsTo: statsTo.value()
            }
            return filter;
        }

        function refreshGrid() {
            var employeeSales = $("#EmployeeSales").data("kendoGrid");
            employeeSales.dataSource.read();
        }

        function onCriteriaChange() {
            updateEmployeeAvatar();
            refreshGrid();
        }
    </script>
}